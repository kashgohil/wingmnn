# Wingmnn - Your Partner-in-crime

## Devlog 1

### DB setup issue
i moved the db into a new package and initialized it there only. the issue is - when i import it in my backend package and try to run it, it does not work. mistake i was making was - i did not setup the database url in my backend package's `.env` file. because of this, db was initializing with my username and it was not connecting to actual db.

then i ran into another problem - this time in cache implementation. so i created a hook that subscribes to the state directly from the query cache. but because i was accessing a key before it was actually set, i was getting undefined every time. because it was unset at the time of invocation, i was not able to even subscribe to the later changes of that key. so i had to add an undefined value in the cache with subscriber attached to it. now, whenever that value changes in the future, i will get notified.

so everything up until now was working. but then i found another issue. my query was not using cache and instead it iwas making new network call everytime. so dug deeper in the query code and found out that i was appliying the cache value to `this.#result` but after that, i was not returning from the executor. so, i exited the executor once result was set from the cache. and voila, it worked!!

there was an issue in the heartbeat calls. it was happening only when i was logged in. so in the event of `authenticated` cache expires and i refresh the page, even though i have valid refresh token, i will still be redirected to login page. i did not want that to happen. so i moved heartbeat call outside of the logged in flow (it doesn't need to authenticate any way because it's token refresher. and everytime i refresh my token, i update the refresh token as well, so nobody can use it).  this heartbeat outside of logged in flow allowed the refresh token to last longer than the `authenticated` cache's expiry time. but then this caused uneasy transition issues. sometimes when heartbeat call is still in progress, it will show landing page and if i refresh it (without logging in), it will take me to the logged in page (because heartbeat call refreshed the token in between, and updated `authenticated` cache). to tackle this, i added a loading screen in between. it will show loader for 4 seconds no matter what heartbeat call returns. after 4 seconds, if it has resolved, then we show the appropriate screen. if it has not resolved yet, then we keep on showing the loading screen. so i implemented the loading state in the `useHeartbeat` hook and used it to show the loading screen. this worked but now the transitions were very abrupt. loading to landing page transitions needed fade effect. so i added it, but not without issue. i added the `AnimatePresence` to make sure that my exit transitions work properly, but i forgot to add a key to my exiting component (loading screen in this case) because i'm stupid. so i asked ai agents and looked up on internet. then eventually, a stackoverflow issue (the OG) opened my eyes to my glaring stupidity (i'm really upset with myself for spending the amount of time i did on this issue when i could've just looked through the docs).
